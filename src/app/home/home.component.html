<div class="trello-board">
    <div class="column" *ngFor="let status of ['Aguardando desenvolvimento', 'Em andamento', 'Em produção']">
        <h3>{{ status }}</h3>
        <div class="card" *ngFor="let task of filterTasksByStatus(status)">
            <h4>{{ task.nome }}</h4>
            <p>{{ task.descricao }}</p>
            <p>Atribuído para: {{ getNameById(task.usuarioId) }}</p>
            <div class="actions">
                <button (click)="editTask(task)"><i class="pi pi-pencil"></i></button>
                <button (click)="deleteTask(task.id ? task.id : 0)"> <i class="pi pi-trash"></i></button>
            </div>
        </div>
        <button (click)="openModal()">+ Adicionar um cartão</button>
    </div>
</div>

<div class="modal" *ngIf="isModalVisible">
    <div class="modal-content">
        <span class="close" (click)="closeModal()">&times;</span>
        <h2 class="modal-title">{{ isEditing ? 'Editar Tarefa' : 'Adicionar Nova Tarefa' }}</h2>

        <form [formGroup]="taskForm" (ngSubmit)="saveTask()">
            <input type="text" nz-input formControlName="nome" placeholder="Nome da tarefa" required />
            <textarea rows="4" nz-input formControlName="descricao" placeholder="Descrição da tarefa"></textarea>
            <nz-date-picker nzFormat="dd/MM/yyyy" formControlName="inicio" nzPlaceHolder="Início"></nz-date-picker>
            <nz-date-picker nzFormat="dd/MM/yyyy" formControlName="fim" nzPlaceHolder="Fim"></nz-date-picker>
            <nz-upload nzType="drag" [nzMultiple]="false" (nzChange)="handleChange($event)"
                nzAccept=".jpg,.jpeg,.png,.gif" [nzShowUploadList]="false" [nzFileList]="fileList">

                <p class="ant-upload-drag-icon">
                    <span nz-icon nzType="inbox"></span>
                </p>

                <p class="ant-upload-text">Clique ou arraste a imagem para esta área para enviar</p>
            </nz-upload>

            <div *ngIf="fileList.length > 0" class="file-preview">
                <div *ngFor="let file of fileList" class="file-item">
                    <img width="80px" height="80px" *ngIf="file && file.type && file.type.startsWith('image/')"
                        [src]="file.url || file.thumbUrl" alt="Preview" class="file-preview-image" />
                    <span>{{ file.name }}</span>
                    <button nz-button nzType="link" (click)="removeFile(file)"><i class="pi pi-trash"></i></button>
                </div>
            </div>

            <nz-select formControlName="usuarioId" nzPlaceHolder="Selecione um usuário" required>
                <nz-option *ngFor="let user of users" [nzValue]="user.id" [nzLabel]="user.nome"></nz-option>
            </nz-select>
            <button nz-button nzType="primary" [disabled]="taskForm.invalid">{{ isEditing ? 'Salvar Alterações' :
                'Adicionar Tarefa' }}</button>
        </form>

    </div>
</div>


<p-toast key="tst"></p-toast>